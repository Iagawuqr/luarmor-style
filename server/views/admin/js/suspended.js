const Suspended={
list:[],
async init(){await this.load();this.bindEvents()},
async load(){const r=await API.get('/api/admin/suspended');if(r.success){this.list=r.suspended||[];this.renderTable();this.updateCount()}else{Utils.toast('Failed to load suspended list','error')}},
updateCount(){const el=document.getElementById('suspendedCount');if(el)el.textContent=this.list.length},
renderTable(){const tbody=document.getElementById('suspendedTableBody');if(!tbody)return;if(this.list.length===0){tbody.innerHTML=`<tr><td colspan="6" class="text-center" style="padding:40px"><div class="empty-state"><div class="empty-state-icon">âœ…</div><h4>No suspended users</h4><p class="text-muted">All users are currently active</p></div></td></tr>`;return}tbody.innerHTML=this.list.map(s=>`<tr class="animate-fadeIn"><td><span class="badge ${s.type==='userId'?'badge-info':s.type==='hwid'?'badge-purple':'badge-warning'}">${s.type}</span></td><td><code class="text-primary" title="${s.value}">${(s.value||'').substring(0,20)}${s.value&&s.value.length>20?'...':''}</code></td><td class="text-secondary">${Utils.escapeHtml(s.reason||'No reason')}</td><td>${s.expiresAt?`<span class="badge badge-warning">${this.formatExpiry(s.expiresAt)}</span>`:'<span class="badge badge-danger">Permanent</span>'}</td><td class="text-muted">${Utils.formatDate(s.suspendedAt||s.createdAt)}</td><td><button class="btn btn-success btn-sm" onclick="Suspended.unsuspend('${s.type}','${s.value}')">âœ“ Unsuspend</button></td></tr>`).join('')},
formatExpiry(expiresAt){const diff=new Date(expiresAt)-Date.now();if(diff<=0)return'Expired';const mins=Math.floor(diff/60000);if(mins<60)return`${mins}m left`;const hours=Math.floor(mins/60);if(hours<24)return`${hours}h left`;return`${Math.floor(hours/24)}d left`},
bindEvents(){},
openAddModal(type='',value=''){document.getElementById('suspendType').value=type||'userId';document.getElementById('suspendValue').value=value||'';document.getElementById('suspendReason').value='';document.getElementById('suspendDuration').value='';document.getElementById('suspendUserId').textContent='-';document.getElementById('suspendHwid').textContent='-';document.getElementById('addSuspendModal').classList.add('active')},
closeAddModal(){document.getElementById('addSuspendModal').classList.remove('active')},
async add(){const type=document.getElementById('suspendType').value;const value=document.getElementById('suspendValue').value.trim();const reason=document.getElementById('suspendReason').value.trim();const durationInput=document.getElementById('suspendDuration').value;if(!value){Utils.toast('Enter a value','error');return}let duration=null;if(durationInput){const num=parseInt(durationInput);if(!isNaN(num)&&num>0)duration=num}const btn=document.getElementById('addSuspendBtn');Utils.setLoading(btn,true);const r=await API.post('/api/admin/suspend',{type,value,reason:reason||'Suspended by admin',duration});Utils.setLoading(btn,false);if(r.success){Utils.toast(r.msg||'User suspended','success');this.closeAddModal();this.load()}else{Utils.toast(r.error||'Failed','error')}},
async unsuspend(type,value){const ok=await Utils.confirm(`Unsuspend this ${type}?`,'Unsuspend');if(!ok)return;const r=await API.post('/api/admin/unsuspend',{type,value});if(r.success){Utils.toast('Unsuspended successfully','success');this.load()}else{Utils.toast(r.error||'Failed','error')}},
async clearAll(){const ok=await Utils.confirm('Clear all suspended entries?','Clear All');if(!ok)return;const r=await API.post('/api/admin/suspended/clear');if(r.success){Utils.toast(`Cleared ${r.cleared||0} entries`,'success');this.load()}else{Utils.toast(r.error||'Failed','error')}},
async refresh(){await this.load();Utils.toast('Refreshed','success')},
render(){return`<div class="page-header"><div><h1 class="page-title">Suspended Users</h1><p class="page-subtitle">Users with temporarily or permanently disabled script access</p></div><div class="header-stats"><span class="badge badge-warning" style="font-size:14px;padding:8px 16px">â¸ï¸ <span id="suspendedCount">0</span> Suspended</span></div></div><div class="card animate-fadeInUp"><div class="card-header"><div class="actions-left"><p class="text-muted text-sm">Suspended users can load script but will be terminated via heartbeat</p></div><div class="actions-right"><button class="btn btn-secondary" onclick="Suspended.refresh()">â†» Refresh</button><button class="btn btn-danger" onclick="Suspended.clearAll()">ğŸ—‘ï¸ Clear All</button><button class="btn btn-primary" onclick="Suspended.openAddModal()">â• Add Suspend</button></div></div><div class="table-container"><table class="table"><thead><tr><th>Type</th><th>Value</th><th>Reason</th><th>Expires</th><th>Suspended At</th><th>Actions</th></tr></thead><tbody id="suspendedTableBody"><tr><td colspan="6" class="text-center" style="padding:40px"><div class="spinner"></div></td></tr></tbody></table></div></div><div class="card animate-fadeInUp" style="margin-top:var(--space-6)"><div class="card-header"><h3 class="card-title"><span class="card-title-icon">â„¹ï¸</span>How Suspend Works</h3></div><div class="card-body"><div class="info-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px"><div><h4 style="margin-bottom:8px">â¸ï¸ Suspend vs ğŸš« Ban</h4><p class="text-muted text-sm">Ban blocks at login. Suspend allows login but terminates via heartbeat - useful for monitoring.</p></div><div><h4 style="margin-bottom:8px">â±ï¸ Duration</h4><p class="text-muted text-sm">Set in seconds. Leave empty for permanent. Examples: 3600 = 1 hour, 86400 = 1 day.</p></div><div><h4 style="margin-bottom:8px">ğŸ¯ Types</h4><p class="text-muted text-sm"><strong>userId</strong>: Roblox ID<br><strong>hwid</strong>: Hardware ID<br><strong>session</strong>: Specific session</p></div></div></div></div><div class="modal-overlay" id="addSuspendModal"><div class="modal"><div class="modal-header"><h3 class="modal-title">â¸ï¸ Suspend User</h3><button class="modal-close" onclick="Suspended.closeAddModal()">âœ•</button></div><div class="modal-body"><div class="form-group"><label class="form-label">Type</label><select id="suspendType" class="form-input form-select"><option value="userId">User ID</option><option value="hwid">HWID</option><option value="session">Session ID</option></select></div><div class="form-group"><label class="form-label">Value</label><input type="text" id="suspendValue" class="form-input" placeholder="Enter value"><div style="margin-top:8px;font-size:12px;color:var(--text-muted)">From session: User <span id="suspendUserId">-</span> | HWID <span id="suspendHwid">-</span></div></div><div class="form-group"><label class="form-label">Reason</label><input type="text" id="suspendReason" class="form-input" placeholder="Why is this user being suspended?"></div><div class="form-group"><label class="form-label">Duration (seconds)</label><input type="number" id="suspendDuration" class="form-input" placeholder="Empty = permanent"><p class="form-help">3600 = 1 hour | 86400 = 1 day | 604800 = 1 week</p></div></div><div class="modal-footer"><button class="btn btn-secondary" onclick="Suspended.closeAddModal()">Cancel</button><button class="btn btn-warning" id="addSuspendBtn" onclick="Suspended.add()">â¸ï¸ Suspend</button></div></div></div>`}
};
